#!/bin/bash

# Fix script: Remove route groups from TanStack Start file names
# Removes (layout-free), (default), (admin), (tabs) etc. from file names

set -e

echo "üõ†Ô∏è  Fixing TanStack Start file names..."
echo "Removing route groups from file names..."

# Function to fix file name by removing route groups
fix_filename() {
    local old_path="$1"
    local new_path="$old_path"
    
    # Get just the filename part
    local dir=$(dirname "$old_path")
    local filename=$(basename "$old_path")
    
    # Remove route groups (parentheses and their contents) followed by dots
    filename=$(echo "$filename" | sed 's/([^)]*)\.*//g')
    
    # Clean up any double dots that might remain
    filename=$(echo "$filename" | sed 's/\.\.*/./g')
    
    # Remove leading dot if present
    filename="${filename#.}"
    
    # Construct new path
    new_path="$dir/$filename"
    
    echo "$new_path"
}

# Find all .tsx files with parentheses and fix them
find apps/web/src/app -name "*.tsx" | grep "(" | while read -r old_file; do
    new_file=$(fix_filename "$old_file")
    
    # Skip if the name wouldn't change
    if [[ "$old_file" == "$new_file" ]]; then
        continue
    fi
    
    echo "üìù $old_file"
    echo "   ‚Üí $new_file"
    
    # Move the file
    mv "$old_file" "$new_file"
    
    echo "   ‚úÖ Fixed"
    echo ""
done

echo "‚úÖ Filename fix complete!" 